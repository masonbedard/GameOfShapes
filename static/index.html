<!DOCTYPE html>
<html>

  <head>

    <link type='text/css' rel='stylesheet' href='/css/style.css'/>
    
    <!-- Fullscreen -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <title>A Game of Shapes</title>

  </head>

  <body>

    <div class='a'></div>
    <div class='option'>TITLE</div> 
    <div class='b'></div>
    <div class='option button' id='play'>play</div>
    <div class='b'></div>
    <div class='option button' id='control'>control</div>
    <div class='b'></div>
    <div class='option button' id='help'>help</div>
    <div class ='a'></div>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="assets/processing.js"></script>
    <script src="/socket.io/socket.io.js"></script>
 
    <script>
      var socket = io.connect(window.location.href);
      var JQdoc = $(document);
      var JQbody = $('body');
      var JQwindow = $(window);
      var touchable = 'createTouch' in document;
    </script>
    <script src='dynamicFont.js'></script>
    <script src='view.js'></script>
    <script src='cont.js'></script>
    <script src='playComm.js'></script>
    <script src='contComm.js'></script>
    <script src="/js/build/app.js"></script>
    <script>

      var makeid = function() {
        var text = '';
        for (var i = 0; i < 4; i++) {
          text += Math.floor((Math.random() * 9)).toString();
        }
        return text;
      }

      JQwindow.resize(function() {
        dynamicFont.getCSS();
      });
        
      $(function() {
        JQdoc.on('click', '#play', function() {
          playComm.roomID = makeid();
          socket.emit('new room', {'roomID': playComm.roomID});
          JQbody.html("<div class='a'></div>" +
            "<div class='option'>TITLE</div>" + 
            "<div class='b'></div>" +
            "<div class='option button' id='desktopstart'>start</div>" +
            "<div class='b'></div>" +
            "<div class='option'>or use id " + playComm.roomID + "</div>" +
            "<div class='b'></div>" +
            "<div class='option'>to connect</div>" +
            "<div class ='a'></div>"
           );
           dynamicFont.setOption();
        });

        JQdoc.on('click', '#control', function() {
          if (touchable) {
            contComm.roomID = prompt('enter room id');
            socket.emit('connect mobile', {'roomID': contComm.roomID}, function(data) {
              if (data.registered) {
                JQbody.html("<div class='a'></div>" +
                  "<div class='option'>TITLE</div>" +
                  "<div class='b'></div>" +
                  "<div class='option'>id " + contComm.roomID + "</div>" +
                  "<div class='b'></div>" +
                  "<div class='option'>connected</div>" +
                  "<div class='b'></div>" +
                  "<div class='option button' id='mobilestart'>start</div>" +
                  "<div class ='a'></div>"
                );
                dynamicFont.setOption();
              }
              else {
                alert('invalid room id');
              }
            });
          }
          else {
            alert('controller must be touch enabled');
          } 
        });

        JQdoc.on('click', '#help', function() {
          JQbody.html("<div class='a'></div>" +
            "<div class='option'>TITLE</div>" +
            "<div class='b'></div>" +
            "<div class='longtext'>how to connect a controller<br><br><span>Choose play on the device that you want to use as the game display.<br><br>Next navigate to this web page on a second device that is touch enabled and choose control.<br><br>Then enter the id given on your game display into the controller.<br><br>If successful, your controller is now connected and you can use it to start!</span></div>" +
            "<div class='b'></div>" +
            "<div class='longtext'>how to play<br><br><span>If you are playing with a controller, hold your touch device with both hands.<br><br>Use your thumbs to manipulate the analog sticks, which appear wherever you initiate contact with the screen.<br><br>The left stick is for movement, while the right stick is for firing.<br><br>The keys w,a,s and d can be used for movement if you are not using a controller or if your controller disconnects.<br><br>The mouse is used for firing without a controller. Simply click in the direction that you want you want the projectiles to go.<br><br>In TITLE you play as the largest blue circle.<br><br>The other circles that you encounter are helpful. But all other shapes are harmful.<br><br>Stop them before they can take you out!</span></div>" +
            "<div class='b'></div>" +
            "<div class='option button' id='back'>back</div>" +
            "<div class='a'></div>"
          );
          dynamicFont.setOption();
          dynamicFont.setLongtext();
        });

        JQdoc.on('click', '#back', function() {
          JQbody.html("<div class='a'></div>" +
            "<div class='option'>TITLE</div>" +
            "<div class='b'></div>" +
            "<div class='option button' id='play'>play</div>" +
            "<div class='b'></div>" +
            "<div class='option button' id='control'>control</div>" +
            "<div class='b'></div>" +
            "<div class='option button' id='help'>help</div>" +
            "<div class ='a'></div>"
          );
          dynamicFont.setOption();
        });

      });

    </script>

  </body>
</html>
